<!DOCTYPE html>
<html lang="en">
    <head>
        <base target="_top">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

        <title> VRRA - Your best reservation system </title>

        <?var url = getScriptUrl();?>
    </head>
    <body>
        <header class="navbar navbar-expand navbar-light bg-light">
            <a href='<?=url?>?page=index' class="navbar-brand">
                <img src="https://drive.google.com/uc?export=view&id=1TLkbGcFes2sW5LRnwI7r-bJc56SArNmh" alt="VRRA logo" class="img-fluid">
            </a>
            <div class="navbar-nav-scroll">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item active">
                        <a href="<?=url?>?page=inquire" class="nav-link">
                            <div>Inquire Reservation</div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="<?=url?>?page=create_reserv" class="nav-link">
                            <div>Create Reservation</div>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="<?=url?>?page=modify_reserv" class="nav-link">
                            <div>Reservation Management</div>
                        </a>
                    </li>
                </ul>
            </div>
            <ul class="navbar-nav ml-md-auto">
                <!--<li class="nav-item">
                    <button type="button" class="btn btn-primary">Sign in</button>
                </li>-->
                <!--<li class="nav-item">
                    <button type="button" class="btn btn-light">Sign up</button>
                </li>-->

                <!-- hide element: class with d-none -->
                <li class="nav-item"> 
                    <a class="nav-item nav-link px-2 py-2" href="#" data-toggle="dropdown" aria-expanded="false">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                            <path d="M13.468 12.37C12.758 11.226 11.195 10 8 10s-4.757 1.225-5.468 2.37A6.987 6.987 0 0 0 8 15a6.987 6.987 0 0 0 5.468-2.63z"/>
                            <path fill-rule="evenodd" d="M8 9a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/>
                            <path fill-rule="evenodd" d="M8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8z"/>
                        </svg>
                        <p class="d-inline" id="userName">Identifying...</p>
                    </a>
                    <!--<div class="dropdown-menu dropdown-menu-md-right">
                        <a href="" class="dropdown-item">
                            <div>Reset password</div>
                        </a>
                        <div class="dropdown-divider"></div>
                        <a href="" class="dropdown-item">
                            <div>Sign out</div>
                        </a>
                    </div>-->
                </li>
            </ul>

            <!-- display element: class without d-none -->
            <div class="alert alert-success d-none" role="alert" style="width: 30%; position: absolute; right: 1%; top: 25%;">
                <div style="display: inline;">message box</div>
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
        </header>
        <main>
            <div>
                <label for="roomNumber"></label>
                <input type="text" id="roomNumber" name="roomNumber" placeholder="Room number">
                <label for="hostName"></label>
                <input type="text" id="hostName" name="hostName" placeholder="Host number"><br>
                <labe for="meetingDate"></labe>
                <input type="date" id="meetingDate" value="">
                <label for="fromTime">Start</label>
                <input type="time" id="fromTime" name="fromTime" placeholder="From time">
                <label for="toTime">End</label>
                <input type="time" id="toTime" name="toTime" placeholder="To time">
                <button type="submit" style="display: inline;" id="search">Search</button>
            </div>
            <div class="table table-hover mb-0">
                <table>
                    <thead>
                        <th scope="col">Room number</th>
                        <th scope="col">Host name</th>
                        <th scope="col">From Time</th>
                        <th scope="col">To Time</th>
                        <th scope="col">Date</th>
                    </thead>
                    <tbody id="table-data">

                    </tbody>
                </table>
            </div>
            <br><br>
            <img src="https://drive.google.com/uc?export=view&id=14OHgCGZ6RqIeFdeU0out6AVIzvfDg6oR" alt="banner"/>
        </main>
        <footer class="container-fluid bg-dark text-light py-3" style="/*position: fixed; bottom: 0;*/">
            <address class="pt-4">
                <p class="d-inline">Contact: </p>
                <a href="mailto:109SE.group26@gmail.com">109SE.group26@gmail.com</a>
            </address>
            <p> &copy; Copyright 109SE.Group26, 2021 </p>
        </footer>

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>
    

<script>
  var account = "example@aaa.com";
          
 $(document).ready(function() {
   google.script.run.withSuccessHandler(changeUserName).getUserAccount();
      
      /*function Status(){
          var rows = range.getValues();
          for (var i = 2, j = rows.length; i<=j; i++){
            var Status = ss.getRange(i,6);
            Status.setFormula("=IF(E" + i + " < TODAY(), true, false)");
          }
          range.sort([{column: 0, ascending: true},{column: 4, ascending: true}]);
      }*/

      google.script.run.withSuccessHandler(print).getAllRRA();

      // search
      $("#search").click(function(){
          isRN = $("#roomNumber").val() === '';
          isHN = $("#hostName").val() === '';
          isFT = $("#fromTime").val() === '';
          isTT = $("#toTime").val() === '';
          isMD = $("#meetingDate").val() === '';

          vaRN = $("#roomNumber").val().toLowerCase();
          vaHN = $("#hostName").val().toLowerCase();
          vaFT = parseInt($("#fromTime").val().replace(':',''));
          vaTT = parseInt($("#toTime").val().replace(':',''));
          vaMD = $("#meetingDate").val();

          $("#table-data").empty();
          $("#table-data").append('Waiting...');
          google.script.run.withSuccessHandler(selectAndPrint).getAllRRA();
          
          //select();
          //console.log("test3");//
      });
      function changeUserName(str) {
            $("#userName").empty();
            $("#userName").append(str);
            account = str;
          }
      
      function selectAndPrint(rows) {
            $("#table-data").empty();
            print(rows);
            select();
          }




//print data all
function print(rows) {
        var rowLen = rows.length;
        for(var i = 0, j = rowLen ; i<j ; i++){
          var dataRow = rows[i];
            $("#table-data").append('<tr>'+'<td>'+dataRow[0]+'</td>'+'<td>'+dataRow[1]+'</td>'+'<td>'+dataRow[2]+'</td>'+'<td>'+dataRow[3]+'</td>'+'<td>'+dataRow[4]+'</td>'+'</tr>');
        }
        if(!rowLen){
            $("#table-data").append('No data');
        }
      }


function select(){
        var i=0;
          $('tbody#table-data tr').each(function(){
              var found = 'false';

              if(isRN || $(this).find("td").eq(0).text().toLowerCase() === vaRN)
                  if(isHN || $(this).find("td").eq(1).text().toLowerCase() === vaHN)
                      if(isFT || parseInt($(this).find("td").eq(3).text().replace(':','')) >= vaFT)
                          if(isTT || parseInt($(this).find("td").eq(2).text().replace(':','')) <= vaTT)
                              if(isMD || $(this).find("td").eq(4).text().replaceAll('/','-') == vaMD)
                                  found = 'true';

              if(found == 'true')
              {
                  $(this).show();
                  i+=1;
              }
              else
              {
                  $(this).hide();
              }
          });
        if(i==0){
          $("#table-data").append('No data');
        }
      };
 });
 </script>

</body>

</script>
</html>